"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.startServer = void 0;
const dgram_1 = __importDefault(require("dgram"));
const fs_1 = __importDefault(require("fs"));
const child_process_1 = __importDefault(require("child_process"));
function startServer(opts = { port: 63423, host: "127.0.0.1" }) {
    const p = child_process_1.default.spawn("ffplay", [
        "-i",
        "-",
        "-fflags",
        "nobuffer",
        "-flags",
        "low_delay",
        "-framedrop",
        "-probesize",
        "32",
        "-analyzeduration",
        "0",
    ]);
    p.stderr.pipe(process.stderr);
    p.stdout.pipe(process.stdout);
    const stream = fs_1.default.createWriteStream(__dirname + "/../test.webm");
    const server = dgram_1.default.createSocket("udp4", (data) => {
        // const index = Number(head.readUInt8());
        // const callback = callbacks.get(index);
        // if (!callback) return;
        // callbacks.delete(index);
        // callback(socket);
        // let previous = performance.now();
        // socket.on("data", (data) => {
        stream.write(data);
        p.stdin.write(data);
        console.log(data.length);
        // 		const now = performance.now();
        // 		console.log(now - previous);
        // 		previous = now;
        // 	});
    });
    server.bind(opts.port, opts.host);
    // return new Promise((resolve) => {
    // 	server.listen(opts.port, opts.host, () => {
    // 		resolve(server);
    // 	});
    // });
}
exports.startServer = startServer;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU2VydmVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL1NlcnZlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFFQSxrREFBMEI7QUFDMUIsNENBQW9CO0FBQ3BCLGtFQUEwQztBQUUxQyxTQUFnQixXQUFXLENBQUMsT0FBdUMsRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxXQUFXLEVBQUU7SUFDcEcsTUFBTSxDQUFDLEdBQUcsdUJBQWEsQ0FBQyxLQUFLLENBQUMsUUFBUSxFQUFFO1FBQ3ZDLElBQUk7UUFDSixHQUFHO1FBQ0gsU0FBUztRQUNULFVBQVU7UUFDVixRQUFRO1FBQ1IsV0FBVztRQUNYLFlBQVk7UUFDWixZQUFZO1FBQ1osSUFBSTtRQUNKLGtCQUFrQjtRQUNsQixHQUFHO0tBQ0gsQ0FBQyxDQUFDO0lBQ0gsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQzlCLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUM5QixNQUFNLE1BQU0sR0FBRyxZQUFFLENBQUMsaUJBQWlCLENBQUMsU0FBUyxHQUFHLGVBQWUsQ0FBQyxDQUFDO0lBRWpFLE1BQU0sTUFBTSxHQUFHLGVBQUssQ0FBQyxZQUFZLENBQUMsTUFBTSxFQUFFLENBQUMsSUFBSSxFQUFFLEVBQUU7UUFDbEQsMENBQTBDO1FBQzFDLHlDQUF5QztRQUN6Qyx5QkFBeUI7UUFFekIsMkJBQTJCO1FBRTNCLG9CQUFvQjtRQUNwQixvQ0FBb0M7UUFFcEMsZ0NBQWdDO1FBQ2hDLE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDbkIsQ0FBQyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDcEIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDekIsbUNBQW1DO1FBQ25DLGlDQUFpQztRQUNqQyxvQkFBb0I7UUFDcEIsT0FBTztJQUNSLENBQUMsQ0FBQyxDQUFDO0lBRUgsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUVsQyxvQ0FBb0M7SUFDcEMsK0NBQStDO0lBQy9DLHFCQUFxQjtJQUNyQixPQUFPO0lBQ1AsTUFBTTtBQUNQLENBQUM7QUE3Q0Qsa0NBNkNDIn0=